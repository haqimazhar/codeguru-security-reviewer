# 🚨 CodeGuru Security Reviewer 🚨

A GitHub Action that parses SARIF results generated by
[AWS CodeGuru Security](https://github.com/aws-actions/codeguru-security) and
adds comments on specific lines of code in a pull request (PR) where issues were
identified. 🎯

[![CI Status](https://github.com/haqimazhar/codeguru-security-reviewer/workflows/build-test/badge.svg)](https://github.com/haqimazhar/codeguru-security-reviewer/actions)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![TypeScript](https://img.shields.io/badge/%3C%2F%3E-TypeScript-blue.svg)](https://www.typescriptlang.org/)

## 📋 Table of Contents

- [Overview](#-overview)
- [Features](#-features)
- [Project Structure](#-project-structure)
- [Installation](#-installation)
- [Usage](#-usage)
- [Configuration](#-configuration)
- [Development](#-development)
- [Contributing](#-contributing)
- [License](#-license)

## 🚀 Overview

`codeguru-security-reviewer` is designed to streamline security feedback on pull
requests by automatically commenting on changed lines where issues were detected
by CodeGuru Security. This action ensures that only issues relevant to modified
lines in a PR are displayed, helping developers focus on addressing actionable
feedback without being overwhelmed.

> ⚠️ **Note:** GitHub comments can only be posted on changed lines in a PR.
> Therefore, some security issues identified by CodeGuru may not be commented on
> if they are not related to the modified lines in the PR. Additionally, scans
> are performed at the path level, so only issues from those paths will be
> included in comments.

## ✨ Features

- 🔍 Automated SARIF parsing and analysis
- 💬 Intelligent PR commenting on modified lines only
- 🔒 Secure GitHub token handling
- 📊 Comprehensive security feedback
- 🚦 Built-in duplicate comment prevention
- 🎯 Focus on relevant security findings

## 📁 Project Structure

```
📦 codeguru-security-review-action
 ┣ 📂 .github
 ┃ ┣ 📂 workflows          # CI/CD workflows
 ┃ ┗ 📜 dependabot.yml     # Dependency updates
 ┣ 📂 src
 ┃ ┣ 📂 types             # TypeScript type definitions
 ┃ ┣ 📂 services          # Core services
 ┃ ┣ 📂 utils             # Utility functions
 ┃ ┗ 📜 index.ts          # Entry point
 ┣ 📂 tests               # Test files
 ┃ ┣ 📂 __fixtures__      # Test fixtures
 ┃ ┗ 📂 __mocks__         # Test mocks
 ┣ 📜 action.yml          # Action metadata
 ┣ 📜 package.json        # Dependencies
 ┗ 📜 tsconfig.json       # TypeScript config
```

## ⚙️ Installation

1. Create a workflow file (e.g., `.github/workflows/security-review.yml`) in
   your repository
2. Add the following configuration:

```yaml
name: Security Review
on:
  pull_request:
    branches: [main]

jobs:
  security-review:
    runs-on: ubuntu-latest
    steps:
      - name: CodeGuru Security Reviewer
        uses: haqimazhar/codeguru-security-reviewer@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          repository: ${{ github.repository }}
          pull_request_number: ${{ github.event.pull_request.number }}
          initial_commit_sha: ${{ github.event.pull_request.head.sha }}
```

## 📝 Usage

### Basic Usage

The action will automatically run on pull requests and comment on security
issues:

```yaml
- name: CodeGuru Security Reviewer
  uses: haqimazhar/codeguru-security-reviewer@v1
  with:
    token: ${{ secrets.GITHUB_TOKEN }}
    repository: ${{ github.repository }}
    pull_request_number: ${{ github.event.pull_request.number }}
    initial_commit_sha: ${{ github.event.pull_request.head.sha }}
```

### Advanced Usage

Configure with custom SARIF file path:

```yaml
- name: CodeGuru Security Reviewer
  uses: haqimazhar/codeguru-security-reviewer@v1
  with:
    token: ${{ secrets.GITHUB_TOKEN }}
    repository: ${{ github.repository }}
    pull_request_number: ${{ github.event.pull_request.number }}
    sarif_path: custom/path/results.sarif.json
    initial_commit_sha: ${{ github.event.pull_request.head.sha }}
```

## ⚡ Configuration

| Input                 | Description                          | Required | Default                                |
| --------------------- | ------------------------------------ | -------- | -------------------------------------- |
| `token`               | 🔑 GitHub token for authentication   | ✅ Yes   |                                        |
| `repository`          | 📂 Repository in `owner/repo` format | ✅ Yes   |                                        |
| `pull_request_number` | 📝 PR number for comments            | ✅ Yes   |                                        |
| `sarif_path`          | 🛡️ Path to SARIF file                | ❌ No    | `codeguru-security-results.sarif.json` |
| `initial_commit_sha`  | 🧩 Initial commit SHA                | ✅ Yes   |                                        |

## 🛠️ Development

### Prerequisites

- Node.js 20.x
- npm 9.x

### Setup

```bash
# Install dependencies
npm install

# Build the project
npm run build

# Run tests
npm test

# Run linting
npm run lint

# Format code
npm run format
```

### Testing

```bash
# Run all tests
npm test

# Run tests in watch mode
npm run test:watch

# Run tests with coverage
npm run test:coverage
```

## 🤝 Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## 📄 License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file
for details.

## 🙏 Acknowledgments

- AWS CodeGuru Security team for their excellent security scanning tool
- Contributors who have helped improve this action

## 📮 Support

For support, please open an issue in the GitHub repository.
